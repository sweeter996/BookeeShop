var excerpt_scroll;
//jQuery(document).ready(function() {
//	excerpt_scroll = new IScroll('.excerpt-images-inner', {
//		scrollX: true,
//		freeScroll: true,
//		probeType: 3,
//		snap: '.excerpt-image'
//	});
//	document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
//});
/*
jQuery(document).on('click', '.view-excerpt', function() {
	jQuery("body").append('<div class="excerpt-overlay"></div>');
	jQuery(".excerpt-box").removeClass('hidden');
	excerpt_scroll.refresh();
	return false;
});
*/
jQuery(document).on('click', '.excerpt-overlay, .excerpt-close', function() {
	jQuery(".excerpt-overlay").remove();
	jQuery(".excerpt-box").addClass('hidden');
	return false;
});
jQuery(document).on('click', '.zoom-in', function() {
	var current_width = jQuery('.excerpt-image').width();
	var next_width = current_width * 1.2;
	jQuery(".excerpt-image").width(next_width);
	excerpt_scroll.refresh();
	return false;
});
jQuery(document).on('click', '.zoom-out', function() {
	var current_width = jQuery('.excerpt-image').width();
	var next_width = current_width * 0.8;
	if (next_width <= jQuery(".excerpt-images-inner").width()) {
		next_width = "100%";
	}
	jQuery(".excerpt-image").width(next_width);
	excerpt_scroll.refresh();
	return false;
});
jQuery(document).on('click', '.excerpt-close-review', function() {
	if (!jQuery(this).hasClass('excerpt-open-review')) {
		jQuery(".excerpt-left").css({
			marginLeft: -241
		});
		jQuery(this).addClass('excerpt-open-review');
		jQuery(".excerpt-view").addClass("excerpt-view-left");
		jQuery(".excerpt-view").css("width", jQuery(".excerpt-view").width() + 241);
	} else {
		jQuery(".excerpt-left").css({
			marginLeft: 0
		});
		jQuery(this).removeClass('excerpt-open-review');
		jQuery(".excerpt-view").removeClass("excerpt-view-left");
		jQuery(".excerpt-view").css("width", jQuery(".excerpt-view").width() - 241);
	}
	jQuery('.excerpt-image').width("100%");
	excerpt_scroll.refresh();
	return false;
});
jQuery(document).on('click', '.excerpt-close-more', function() {
	if (!jQuery(this).hasClass('excerpt-open-more')) {
		jQuery(".excerpt-right").css({
			marginRight: -241
		});
		jQuery(this).addClass('excerpt-open-more');
		jQuery(".excerpt-view").addClass("excerpt-view-right");
		jQuery(".excerpt-view").css("width", jQuery(".excerpt-view").width() + 241);
	} else {
		jQuery(".excerpt-right").css({
			marginRight: 0
		});
		jQuery(this).removeClass('excerpt-open-more');
		jQuery(".excerpt-view").removeClass("excerpt-view-right");
		jQuery(".excerpt-view").css("width", jQuery(".excerpt-view").width() - 241);
	}
	jQuery('.excerpt-image').width("100%");
	excerpt_scroll.refresh();
	return false;
});
jQuery(document).on('click', '.excerpt-recent .prev, .excerpt-recent .next', function() {
	jQuery.ajax({
		url: fn_url("products.look_inside_recent"),
		type: 'get',
		dataType: 'json',
		data: {
			'product_id': jQuery(this).attr("product-id"),
			'page': jQuery(this).attr("alt")
		},
		beforeSend: function() {
			var current_height = jQuery(".excerpt-recent-list").outerHeight();
			jQuery(".excerpt-recent-list").css({
				height: current_height
			});
			jQuery(".excerpt-recent-list").html('');
			jQuery(".excerpt-recent-list").addClass("ajax-loading");
		},
		success: function(response) {
			if (response.text) {
				response = $.parseJSON(response.text);
			}
			jQuery(".excerpt-recent-block").html(response.html);
		}
	});
	return false;
});
jQuery(document).on('click', '.excerpt-recommend .prev, .excerpt-recommend .next', function() {
	jQuery.ajax({
		url: fn_url("products.look_inside_recommend"),
		type: 'get',
		dataType: 'json',
		data: {
			'product_id': jQuery(this).attr("product-id"),
			'page': jQuery(this).attr("alt")
		},
		beforeSend: function() {
			var current_height = jQuery(".excerpt-recommend-list").outerHeight();
			jQuery(".excerpt-recommend-list").css({
				height: current_height
			});
			jQuery(".excerpt-recommend-list").html('');
			jQuery(".excerpt-recommend-list").addClass("ajax-loading");
		},
		success: function(response) {
			if (response.text) {
				response = $.parseJSON(response.text);
			}
			jQuery(".excerpt-recommend-block").html(response.html);
		}
	});
	return false;
});
jQuery(document).on('click', '.excerpt-prev', function() {
	excerpt_scroll.refresh();
	excerpt_scroll.prev(100);
	js_updateOutline();
	return false;
});
jQuery(document).on('click', '.excerpt-next', function() {
	excerpt_scroll.refresh();
	excerpt_scroll.next(100);
	js_updateOutline();
	return false;
});
jQuery(document).on('click', '.excerpt-outline li a', function() {
	excerpt_scroll.refresh();
	var page = jQuery(this).attr("class").replace('excerpt-image-', '');
	page = page ? page : 1;
	jQuery(this).parents('ul').find('li').removeClass('current');
	jQuery(this).parent('li').addClass('current');
	excerpt_scroll.goToPage(0, page - 1, 100);
	return false;
});
function js_updateOutline() {
	var page = excerpt_scroll.currentPage.pageY;
	jQuery(".excerpt-outline li").removeClass('current');
	jQuery(".excerpt-outline .excerpt-image-" + (page + 1)).parent('li').addClass('current');
}